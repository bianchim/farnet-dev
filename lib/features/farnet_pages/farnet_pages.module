<?php

/**
 * @file
 * Code for the Farnet pages feature.
 */

include_once 'farnet_pages.features.inc';

/**
 * Implements hook_field_group_info_alter().
 */
function farnet_pages_field_group_info_alter($groups) {
  if (!empty($groups['group_page_content|node|page|form'])) {
    $groups['group_page_content|node|page|form']->data['children'][1] = 'field_farnet_abstract';
    $groups['group_page_content|node|page|form']->data['children'][2] = 'field_ne_body';
    $groups['group_page_content|node|page|form']->data['children'][3] = 'field_picture';
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function farnet_pages_form_node_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id == 'page_node_form') {
    $form['group_content_access'][LANGUAGE_NONE]['#required'] = FALSE;
  }
}

/**
 * Implements hook_COMPONENT_alter().
 *
 * COMPONENT = field_default_field_instances.
 */
function farnet_pages_field_default_field_instances_alter(&$fields) {

  foreach ($fields as $key => $field) {
    if (strpos($field['field_name'], 'group_content_access') !== false) {
      dpm($key);
      dpm($field);
    }
    if (strpos($field['field_name'], 'og_group_ref') !== false) {
      dpm($key);
      dpm($field);
    }
  }

  if (isset($fields['group_content_access'])) {
    dpm($fields['group_content_access']);
  }
  if (isset($fields['og_group_ref'])) {
    dpm($fields['og_group_ref']);
  }

  if (isset($fields['node-nexteuropa_pages-field_ne_body'])) {
    dpm($fields['node-nexteuropa_pages-field_ne_body']);
  }
  if (isset($fields['node-nexteuropa_pages-group_content_access'])) {
    dpm($fields['node-nexteuropa_pages-group_content_access']);
  }
  if (isset($fields['node-nexteuropa_pages-og_group_ref'])) {
    dpm($fields['node-nexteuropa_pages-og_group_ref']);
  }

  if (isset($fields['node-farnet_pages-field_ne_body'])) {
    dpm($fields['node-farnet_pages-field_ne_body']);
  }
  if (isset($fields['node-farnet_pages-group_content_access'])) {
    dpm($fields['node-farnet_pages-group_content_access']);
  }
  if (isset($fields['node-farnet_pages-og_group_ref'])) {
    dpm($fields['node-farnet_pages-og_group_ref']);
  }

  if (isset($fields['node-page-field_ne_body'])) {
    dpm($fields['node-page-field_ne_body']);
  }
  if (isset($fields['node-page-group_content_access'])) {
    dpm($fields['node-page-group_content_access']);
  }
  if (isset($fields['node-page-og_group_ref'])) {
    dpm($fields['node-page-og_group_ref']);
  }

  if (isset($fields['node-page-field_ne_body'])) {
    if (isset($fields['node-page-field_ne_body']['display'])) {
      $fields['node-page-title_field']['display']['default']['weight'] = 4;
    }
  }
  if (isset($fields['node-page-group_content_access'])) {
    if (isset($fields['node-page-group_content_access']['display'])) {
      $fields['node-page-group_content_access']['display']['default']['label'] = "hidden";
      $fields['node-page-group_content_access']['display']['default']['settings'] = array();
      $fields['node-page-group_content_access']['display']['default']['type'] = "hidden";
    }
  }
  if (isset($fields['node-page-og_group_ref'])) {
    if (isset($fields['node-page-og_group_ref']['display'])) {
      $fields['node-page-og_group_ref']['display']['default']['label'] = "hidden";
      $fields['node-page-og_group_ref']['display']['default']['settings'] = array();
      $fields['node-page-og_group_ref']['display']['default']['type'] = "hidden";
    }
  }
}
