<?php

/**
 * @file
 * Install processes for FARNET communities.
 */

include_once 'farnet_communities.install.inc';

/**
 * Implements hook_schema().
 */
function farnet_communities_schema() {
  return ['user_last_contribution' => _farnet_communities_table_schema()];
}

/**
 * Implements hook_install().
 */
function farnet_communities_install() {
  features_revert_module("farnet_communities");

  _farnet_communities_update_content_types();

  // Add myFARNET support node and menu item.
  $nid = _farnet_communities_update_create_myfarnet_support_node();
  _farnet_communities_update_create_myfarnet_support_menu_item($nid);
  variable_set('myfarnet_support', $nid);

  // Add users to the myFARNET support community.
  _farnet_communities_add_all_existing_users_on_myfarnet_support();
}

/**
 * Set all content types as not required in communities update.
 *
 * Implements hook_update_N().
 */
function farnet_communities_update_7001() {
  _farnet_communities_update_content_types();
}

/**
 * Add the last contribution table.
 */
function farnet_communities_update_7002() {
  db_create_table('user_last_contribution', _farnet_communities_table_schema());
}

/**
 * Add myFARNET support node and menu item.
 */
function farnet_communities_update_7003() {
  $nid = _farnet_communities_update_create_myfarnet_support_node();
  _farnet_communities_update_create_myfarnet_support_menu_item($nid);
  variable_set('myfarnet_support', $nid);
}

/**
 * Add users to the myFARNET support community.
 */
function farnet_communities_update_7004() {
  _farnet_communities_add_all_existing_users_on_myfarnet_support();
}
